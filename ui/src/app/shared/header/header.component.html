<div class="content">
  <mat-form-field class="query-form">
    <mat-chip-list #chipList>
      <mat-chip id="chip" *ngFor="let chipKey of getChipKeys()"
               [matMenuTriggerFor]="menu"
               (remove)="removeChip(chipKey)"
               (click)="setCurrentChip(chipKey)">
        {{ getDisplayValue(chipKey) }}
        <img matChipRemove
             src="https://www.gstatic.com/images/icons/material/system/1x/cancel_grey600_18dp.png">
      </mat-chip>
      <mat-menu #menu="matMenu" [ngSwitch]="getCurrentChipType()" [overlapTrigger]="false" class="wide-menu">
        <mat-form-field *ngSwitchCase="'free text'" class="query-input">
          <!--Free text input-->
          <input matInput
                 placeholder="Equals"
                 type="search"
                 [(ngModel)]="currentChipValue"
                 (keyup.enter)="assignChipValue()"
                 (click)="$event.stopPropagation()"/>
        </mat-form-field>
        <!-- Statuses -->
        <mat-list *ngSwitchCase="'statuses'">
          <mat-list-item  *ngFor="let status of jobStatuses">
            <mat-checkbox
              (click)="$event.stopPropagation()"
              [checked]="isChecked(status)"
              (change)="changeStatus(status, $event.checked)">
              {{ status }}
            </mat-checkbox>
          </mat-list-item>
        </mat-list>
        <!-- Datepicker input -->
        <mat-form-field *ngSwitchCase="'date'" class="query-input">
          <input id="dateInput"
                 matInput
                 [matDatepicker]="picker"
                 placeholder="{{ getDatePlaceholder() }}"
                 [(ngModel)]="currentChipValue"
                 (click)="$event.stopPropagation()"
                 (dateChange)="assignDateValue($event.value)">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker ></mat-datepicker>
        </mat-form-field>
      </mat-menu>
      <input matInput
             placeholder="Filter jobs..."
             [(ngModel)]="inputValue"
             value="{{inputValue}}"
             [matAutocomplete]="auto"
             [matChipInputFor]="chipList"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             [matChipInputAddOnBlur]="false"
             (matChipInputTokenEnd)="addChip($event.value)"
             [formControl]="control"/>
      <mat-autocomplete #auto="matAutocomplete">
        <mat-option
          *ngFor="let option of filteredOptions | async"
          [value]="option"
          (click)="addChip(option)">
          {{ option }}
        </mat-option>
      </mat-autocomplete>
    </mat-chip-list>
    <button mat-icon-button matSuffix class="search-button" (click)="search()">
      <img src="https://www.gstatic.com/images/icons/material/system/1x/search_grey600_24dp.png">
    </button>
  </mat-form-field>

  <div class="search-table-controls">
    <div *ngIf="shouldDisplayStatusButtons()">
      <button mat-raised-button class="status-button" (click)="showActiveJobs()">ACTIVE</button>
      <button mat-raised-button class="status-button" (click)="showFailedJobs()">FAILED</button>
      <button mat-raised-button class="status-button" (click)="showCompletedJobs()">COMPLETED</button>
    </div>

    <mat-paginator *ngIf="jobs" #paginator
                   [length]="jobs.value.results.length"
                   [pageIndex]="0"
                   [pageSize]="pageSize"
                   [hidePageSize]="true">
    </mat-paginator>
  </div>
</div>
