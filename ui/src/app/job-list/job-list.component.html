<jm-header
  class="header"
  [jobs]="jobs"
  [pageSize]="pageSize"
  [showControls]="true"></jm-header>
<mat-divider class="divider"></mat-divider>
<div class="table-container">
  <span class="settings-icon-container">
    <button mat-icon-button class="shard-icon" [matMenuTriggerFor]="settingsMenu" class="settings-icon">
      <clr-tooltip>
        <clr-icon clrTooltipTrigger shape="cog" size="18"  class="is-solid"></clr-icon>
        <clr-tooltip-content clrPosition="left"  clrSize="xs" *clrIfOpen>
          <span>view settings</span>
        </clr-tooltip-content>
      </clr-tooltip>
    </button>
  <mat-menu #settingsMenu="matMenu" class="wide-menu settings-menu" xPosition="before" yPosition="below" [overlapTrigger]="false">
    <h2 class="settings-header">Displayed columns</h2>
    <mat-list>
      <mat-list-item *ngFor="let df of displayFields">
        <mat-checkbox [checked]="df.primary"
                      (change)="toggleDisplayColumn(df)"
                      (click)="$event.stopPropagation()">{{ df.display }}</mat-checkbox>
      </mat-list-item>
    </mat-list>
    <mat-divider></mat-divider>
    <div class="field-container">
      <mat-form-field class="page-count">
        <input matInput placeholder="Jobs per page" [formControl]="pageSizeFormControl" [value]="pageSize" (click)="$event.stopPropagation()" (change)="updatePerPage($event)">
        <mat-error *ngIf="pageSizeFormControl.hasError('min') || pageSizeFormControl.hasError('required')">must be at least 1</mat-error>
      </mat-form-field>
    </div>
    <mat-divider></mat-divider>
    <div class="settings-button-container">
      <button class="apply-link" (click)="saveSettings()">Done</button>
    </div>
  </mat-menu>
  </span>
  <jm-job-list-table
    class="job-list-table"
    [ngStyle]="{'opacity': tableOpacity}"
    [dataSource]="dataSource"
    (onJobsChanged)="handleJobsChanged()"
    [displayFields]="displayFields">
  </jm-job-list-table>
  <div *ngIf="loading" class="spinner-container">
    <mat-spinner></mat-spinner>
  </div>
</div>
