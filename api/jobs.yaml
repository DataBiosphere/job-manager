swagger: '2.0'
info:
  title: Job Monitor Service
  description: Job Monitor API for interacting with asynchronous batch jobs and workflows.
  license:
    name: BSD
    url: 'http://opensource.org/licenses/BSD-3-Clause'
  version: '0.0.1'
produces:
  - application/json
paths:
  '/jobs/{id}/abort':
    post:
      summary: Abort a job by ID
      parameters:
        - name: id
          description: Job ID
          required: true
          type: string
          in: path
      responses:
        '200':
          description: Successful Request
          schema:
            $ref: '#/definitions/JobAbortResponse'
        '400':
          description: Malformed Job ID
        '403':
          description: Job in terminal status
        '404':
          description: Job ID Not Found
        '500':
          description: Internal Error
  '/jobs/query':
    post:
      summary: Query jobs by start dates, end dates, names, ids, or statuses.
      parameters:
        - name: parameters
          required: true
          in: body
          schema:
            type: array
            items:
              $ref: '#/definitions/JobQueryParameter'
          description: >
            Same query parameters as GET /query endpoint, submitted as a json list.
            Example: [{"status":"Success"},{"status":"Failed"}]
      responses:
        '200':
          description: Successful Request
          schema:
            $ref: '#/definitions/JobQueryResponse'
        '400':
          description: Malformed Request
        '500':
          description: Internal Error
  '/jobs/{id}':
    get:
      summary: Query for job and task-level metadata for a specified job
      parameters:
        - name: id
          description: Job ID
          required: true
          type: string
          in: path
      responses:
        '200':
          description: Successful Request
          schema:
            $ref: '#/definitions/JobMetadataResponse'
        '400':
          description: Malformed Job ID
        '404':
          description: Job ID Not Found
        '500':
          description: Internal Error
definitions:
  JobAbortResponse:
    required:
      - id
      - status
    properties:
      id:
        type: string
        description: The identifier of the job
      status:
        type: string
        description: The status of the job
  JobMetadataResponse:
    description: Job and task level metadata
    required:
      - id
      - status
      - submission
    properties:
      id:
        type: string
        description: The identifier of the job
      status:
        type: string
        description: The status of the job
      submission:
        type: string
        format: date-time
        description: Submission datetime of the job in ISO8601 format with milliseconds
      start:
        type: string
        format: date-time
        description: Start datetime of the job in ISO8601 format with milliseconds
      end:
        type: string
        format: date-time
        description: End datetime of the job in ISO8601 format with milliseconds
      inputs:
        type: object
        description: Map of input keys to input values
      outputs:
        type: object
        description: Map of output keys to output values
      labels:
        type: object
        description: Custom job labels with string values
      tasks:
        $ref: '#/definitions/TaskMetadata'
      failures:
        type: array
        items:
          $ref: '#/definitions/FailureMessage'
  TaskMetadata:
    description: Task level metadata
    required:
      - inputs
      - executionStatus
    properties:
      inputs:
        type: object
        description: Mapping of input fully qualified names to stringified values
      executionStatus:
        type: string
        description: Status in Cromwell execution terms.
      start:
        type: string
        format: date-time
        description: Start datetime of the task execution in ISO8601 format with milliseconds
      end:
        type: string
        format: date-time
        description: End datetime of the task execution in ISO8601 format with milliseconds
      jobId:
        type: string
        description: Backend-specific job ID
      failures:
        type: array
        items:
          $ref: '#/definitions/FailureMessage'
      returnCode:
        type: integer
        description: Task execution return code
      stdout:
        type: string
        description: Path to the standard output file for this task
      stderr:
        type: string
        description: Path to the standard error file for this task
  FailureMessage:
    description: Failure messages
    required:
      - failure
      - timestamp
    properties:
      failure:
        type: string
        description: The failure message
      timestamp:
        type: string
        format: date-time
        description: The time at which this failure occurred
  JobQueryParameter:
    description: Job query parameters
    minProperties: 1
    maxProperties: 1
    properties:
      start:
        type: string
        format: date-time
        description: >
          Returns only jobs with an equal or later start datetime.  Can be specified at most once.
          If both start and end date are specified, start date must be before or equal to end date.
      end:
        type: string
        format: date-time
        description: >
          Returns only jobs with an equal or earlier end datetime.  Can be specified at most once.
          If both start and end date are specified, start date must be before or equal to end date.
      status:
        type: string
        enum:
          - Submitted
          - Running
          - Aborting
          - Failed
          - Succeeded
          - Aborted
        description: >
          Returns only jobs with the specified status.  If specified multiple times,
          returns jobs in any of the specified statuses.
      name:
        type: string
        pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
        description: >
          Returns only jobs with the specified name.  If specified multiple times,
          returns jobs with any of the specified names.
      parentId:
        type: string
        format: string
        description: >
          Returns only jobs with the given parent ID. This parameter may be
          unsupported for some API implementations or required for others
          depending on whether there exists a logical noun above a job
          in the resource hierarchy (for example, a cloud project). If the
          presence of this parameter is incompatible with the server, it may
          return a 400 HTTP status.
  JobQueryResponse:
    description: Response to a job query
    required:
      - results
    properties:
      results:
        type: array
        items:
          $ref: '#/definitions/JobQueryResult'
  JobQueryResult:
    description: Result for an individual job returned by a job query
    required:
      - id
      - name
      - status
      - start
    properties:
      id:
        type: string
        description: Job ID
      name:
        type: string
        description: Job name
      status:
        type: string
        description: Job status
      start:
        type: string
        format: date-time
        description: Job start datetime
      end:
        type: string
        format: date-time
        description: Job end datetime
      labels:
        type: object
        description: Custom job labels with string values
