# Job Manager API Server: `cromwell`

Thin shim around [`cromwell`](https://github.com/broadinstitute/cromwell).

## Development
For cromwell setup see the Cromwell README:
1. Set the `CROMWELL_URL` environment variable to specify which cromwell instance to use. Job Manager pulls workflow data from `https://cromwell.mint-dev.broadinstitute.org/api/workflows/v1` by default:
```
export CROMWELL_URL=https://cromwell.test-cromwell.broadinstitute.org/api/workflows/v1
```
2. Add a file named `config.json` to `job-manager/servers/cromwell/jobs` that contains the username and password for the specified cromwell instance:
```
{
  "cromwell_user" : "USERNAME",
  "cromwell_password" : "PASSWORD"
}
```

## Running Tests
To run unit and integration tests on the python-flask app, install
[`tox`](https://github.com/tox-dev/tox).
```
cd servers/cromwell
tox -- -s
```

## Generating `requirements.txt`

`requirements.txt` is autogenerated from `requirements-to-freeze.txt`. The
latter lists only direct dependencies. To regenerate run:
```
virtualenv --python=/usr/bin/python2 /tmp/cromwell-server-requirements
source /tmp/cromwell-server-requirements/bin/activate
pip install -r servers/cromwell/requirements-to-freeze.txt
pip freeze | sort > servers/cromwell/requirements.txt
deactivate
```
